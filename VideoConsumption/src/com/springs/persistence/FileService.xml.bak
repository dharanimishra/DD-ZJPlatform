<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.springs.persistence.FileService">
	
	<resultMap id="result" type="file">
	<result property="videoId" column="videoId"/>
        <result property="name" column="name"/>
        <result property="description" column="description"/>
         <result property="time" column="time"/>
          <result property="bookmarkTitle" column="bookmarkTitle"/>
    </resultMap>
	
	<resultMap id="fileInfoResult" type="fileInfo">
		<result property="fileId" column="fileId"/>
        <result property="fileName" column="fileName"/>
        <result property="filePath" column="filePath"/>
        <result property="title" column="title"/>
    </resultMap>
    
    <resultMap id="playListResult" type="playlist">
		<result property="fileId" column="fileId"/>
        <result property="fileName" column="fileName"/>
        <result property="filePath" column="filePath"/>
    </resultMap>
    
    
      <resultMap id="bookMarkListResult" type="bookmark">
        <result property="videoName" column="videoName"/>
        <result property="title" column="title"/>
        <result property="time" column="time"/>
    </resultMap>
    
	<select id="getFilesInfo" resultMap="fileInfoResult">  
		SELECT fileId, fileName,filePath,title
		FROM fileInfo order by fileName
	</select>
	
	
	<select id="getFileNotesList" resultMap="result">  
		select videoid,name,description,time,bookmarktitle
		from file where name=#{name} order by time
	</select>
	
	<insert id="saveFile" parameterType="string">
		insert into file (videoid,name,description,time,bookmarktitle) 
    	value ((select fileid from fileinfo where filename=#{name}),#{name},#{description},#{time},#{bookmarkTitle})
	</insert>
	
	<insert id="addPlayList" parameterType="playlist">
		insert into playlist (filename, filepath) 
    	value (#{fileName},#{filePath})
	</insert>
	
	<select id="findPlayList" resultMap="playListResult">  
		select fileid,filename,filepath
		from playlist where filename=#{fileName}
	</select>
	
	<select id="getPlayList" resultMap="playListResult">  
		select fileid, filename,filepath
		from playlist order by filename
	</select>

	<insert id="addBookMark" parameterType="bookmark">
		insert into bookmark (videoid, videoname, title, time) 
    	value ((select fileid from fileinfo where filename=#{videoName}),#{videoName},#{title},#{time})
	</insert>
	
	<select id="getBookMarkList" resultMap="bookMarkListResult">  
		select title,time
		from bookmark where videoname=#{videoName} order by title
	</select>
	
	<update id="updateFileInfo" parameterType="file"> 
  		update file
  		set
  			name = #{name},
  			time= #{time},
 			description = #{description},  
			bookmarktitle = #{bookmarkTitle} 
  		where (videoid = #{videoId} and time = #{time})
	</update>
</mapper>